# XLeRobot Playground (0.1.5)

[![en](https://img.shields.io/badge/lang-en-red.svg)](sim.md)
[![中文](https://img.shields.io/badge/lang-中文-green.svg)](sim_CN.md)

> [!NOTE] 
> 基于 [ManiSkill](https://maniskill.readthedocs.io/en/latest/index.html), [RoboCasa](https://github.com/robocasa/robocasa), [ReplicaCAD](https://aihabitat.org/datasets/replica_cad/), 和 [AI2Thor](https://github.com/allenai/ai2thor) 构建. 特别感谢ManiSkill3的主要负责人Stone Tao，与他的详细讨论帮助我快速熟悉了ManiSkill。

> [!NOTE] 
> 在这里看 [详细安装使用教程](sim_guide_CN.md)

https://github.com/user-attachments/assets/c9d664e0-4bba-4eec-bfe2-14fd4755e677


## 我们在模拟中拥有的功能/您可以做什么

- **键盘底座移动和关节控制** 
- **键盘底座移动和末端执行器控制**，带有内置的解析IK功能（这是我们用于主要演示的功能）
- **键盘底座移动和基于VR的末端执行器控制**（需要Oculus Quest）：
  - 可选择VR摇杆或纯手部追踪
  - 目前仅支持位置控制
  - 基于手势的姿态控制和抓取器控制将很快更新
- **许多研究机会**可供探索：MPC、模仿学习、数据收集、RL、VLA等。

所有这些演示都可以根据您的需要在多个不同场景中运行。

## 关于模拟中的远程操作演示

💡 **要点：**

- 所有演示都在`demo_ee_control.py`中实现，使用ManiSkill中的3个不同场景，利用我专门为SO100手臂开发的新型混合关节-末端执行器控制器
- 所有任务都是一次完成的 - 我只删除了没有操作的时段（完全静止的屏幕）和手动相机角度调整
- 除非另有说明，所有机器人动作都由键盘控制
- 目前尚未集成相机。用于控制的唯一输入是演示视频中确切显示的交互界面。相机集成将在XLeRobot 0.2.0中更新到URDF和相应代码中
- 为了方便直接在ManiSkill中运行，我直接替换了Fetch机器人的相应URDF模型和机器人设置，将XLeRobot命名为"fetch"。未来，当ManiSkill正式支持XLeRobot时，它可以在模拟中作为独立机器人直接调用
  - 当前的Fetch底座只有前进/后退和转向（2个自由度），相对难以修改，所以我们暂时按原样使用。然而，在现实中，XLeRobot的全向轮底座有3个自由度（前进/后退、左/右、旋转），使移动更加方便和灵活
- 在模拟中，由于碰撞模型参数设置，抓取物体时可能会出现不稳定抓取和高频振动，这可能导致视频中物体突然位移。这在现实中不会发生（尽管现实目前没有模拟中可用的精确稳定角度控制）

## 关于混合关节-末端执行器控制器

该控制器将传统IK解耦为不同组件，这些组件可以直接控制或通过简单的解析解决方案（我们在高中学习的余弦定理）求解。

### 水平平面控制
- 使用**极坐标**而非笛卡尔坐标，允许通过joint1直接控制
- **极坐标相对于笛卡尔坐标的优势：**
  - 对人类控制更直观，简化键盘控制和未来VR控制难度
  - 有利于任务规划，因为旋转对称性 - 在许多情况下可以将搜索空间和状态空间从3D减少到2D
  - 为AI大模型训练提供对称性，只需专注于垂直平面。以极坐标形式构建训练数据集可以大大提高VLA模型训练效率和策略泛化能力
    - SO2旋转对称性在许多论文中被证明优于传统方法，如Dian Wang在他博士期间关于使用等变模型改进RL、VLA（[等变扩散策略](https://equidiff.github.io/)）和抓取优化算法以提高机器人学习效率和泛化能力的系列工作

- 如果您仍然想使用笛卡尔坐标而非极坐标，只需基于此转换公式添加1-2行代码：
  - `ee_pose[0] = sqrt(x^2 + y^2)`，`ee_pose[1] = z`，`target_joint1 = arctan2(x,y)`

### 垂直平面控制
- 不考虑机器人方向控制的情况下，垂直平面变成一个2关节连杆，在SO100的角度>0约束下有唯一的解析解。可以使用高中的简单余弦定理一步求解

### 末端方向
- 由于是5DOF，偏航角不能改变
- SO100的第5关节直接对应滚转角
- SO100的第4关节直接对应俯仰角（注意：计算俯仰角时，需要补偿前一个垂直平面高度，但仍有唯一的解析解）

## 硬件设置版本

XLeRobot提供4种硬件设置版本：

1. **基本固定臂底座（后部）** - 手臂安装在推车后部，以充分利用存储空间
2. **固定臂底座（前部）** - 手臂安装在推车前部，以获得更好的双臂操作能力，但无法利用推车存储空间
3. **z轴移动臂底座（前部）** - 用于潜在应用
4. **z轴移动臂底座（后部）** - 用于潜在应用

> **注意：** 2种固定底座版本将在下个月发布的XLeRobot 0.2.0中完成。移动底座版本用于潜在应用，目前没有具体计划。



## 局限性

您可以看到，对于基本固定底座版本，仍有许多地方无法触及。

## 深入探讨

### 高级操作策略

探索远程操作中使用的操作策略，以及我们如何利用这些高级策略充分发挥XLeRobot的潜力：

#### 移动底座集成
- **弥补手臂局限性**：移动底座的额外自由度和驱动力可以弥补SO100手臂的局限性（5DOF、小范围、低负载约1.2kg）
- **示例 - 打开冰箱门**：尽管手臂负载仅约1.2kg，但当手臂伸展并紧握物体同时向后移动推车时，拉力限制变为轮电机扭矩限制、抓取器摩擦限制和轮胎-地面摩擦限制 - 这些通常都高于手臂的负载限制

#### 非抓取操作
- **超越拾取和放置**：利用非抓取操作可以大大提高XLeRobot的效率、稳健性和物理极限。在家庭操作任务中，肯定不仅仅是拾取和放置
- **理解物理世界**：机器人需要充分理解物理世界，并通过直觉物理（世界模型，与Yann LeCun的想法一致）预测/推理可能的物理交互
- **优化辅助**：在机器人发展完整智能之前，我们可以使用基于成本函数/能量函数的优化/MPC/基于模型的RL来辅助复杂规划。之后，机器人可以根据对物理世界的理解设计相关函数

#### 高级技术
- **基于碰撞的抓取**：在拥挤或堵塞的环境中（紧密排列的瓶子，书架上密集排列的书籍），机器人需要利用碰撞来改变环境，以实现更方便的物体分布用于抓取，有时还使用顺应性引导自己到目标位置
- **策略级错误纠正**：例如，当瓶子倾倒时立即切换到不同的抓取方向，或者当当前瓶子暂时无法触及时切换到另一个瓶子

### 研究贡献
- **"时间中的笼罩"**（被IJRR接受）：提供了稳健物体操作的方法，特别是非抓取操作
- **Rice RobotPI实验室**：我们实验室的主要研究方向是基于漏斗的操作

## 链接
- [Dian Wang的主页](https://www.dianwang.io/)
- [等变扩散策略](https://equidiff.github.io/)
